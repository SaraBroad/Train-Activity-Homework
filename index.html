<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Train Activity</title>
    <link rel="stylesheet" type="text/css" href="assets/css/style.css">
    <script src="https://www.gstatic.com/firebasejs/live/3.0/firebase.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">

</head>

<body>

    <div class="container">
        <div class="jumbotron" style="background-color: #2F4F4F; color: white">
            <h1 class="text-center">Anytime is Train Time</h1>
            <h3 class="text-center">Better Than Septa</h3>
        </div>

        <div class="row">
            <div class="col-lg-12">
                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Current Train Schedule</strong>
                        </h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-hover" id='train-table'>
                            <thead>
                                <tr>
                                    <th>Train Name</th>
                                    <th>Destination</th>
                                    <th>Frequency(min)</th>
                                    <th>Next Arrival</th>
                                    <th>Minutes Away</th>
                                </tr>
                            </thead>
                            <tbody id="train-body">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="panel panel-primary">
                    <div class="panel-heading">
                        <h3 class="panel-title">
                            <strong>Add Train</strong>
                        </h3>
                    </div>
                    <div class="panel-body">

                        <!-- Entry Form -->
                        <form>
                            <div class="form-group">
                                <label for="train-name-input">Train Name</label>
                                <input class="form-control" id="train-name-input" required type="text">
                            </div>
                            <div class="form-group">
                                <label for="destination-input">Destination</label>
                                <input class="form-control" id="destination-input" required type="text">
                            </div>
                            <div class="form-group">
                                <label for="start-input">First Train Time (HH:mm - military time)</label>
                                <input class="form-control" id="first-train-input" required type="text">
                            </div>
                            <div class="form-group">
                                <label for="frequency-input">Frequency(min)</label>
                                <input class="form-control" id="frequency-input" required type="number">
                            </div>
                            <button class="btn btn-primary" id="add-train-btn" type="submit">Submit</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.21.0/moment.js"></script>
    <script>


        var config = {
            apiKey: "AIzaSyDXwQQF_CwIYzd0meEGPmeoxmr1oeRPOqE",
            authDomain: "train-scheduler-26c8e.firebaseapp.com",
            databaseURL: "https://train-scheduler-26c8e.firebaseio.com",
            projectId: "train-scheduler-26c8e",
            storageBucket: "train-scheduler-26c8e.appspot.com",
            messagingSenderId: "134693941267"
        };
        firebase.initializeApp(config);

        var database = firebase.database();

        //on click function for adding user
        $("form").on("submit", function (event) {
            event.preventDefault();

            var trainName = $("#train-name-input").val().trim();
            var destination = $("#destination-input").val().trim();
            var firstTrain = $("#first-train-input").val().trim();
            // var firstTrain = moment($("#first-train-input").val().trim()).format("HH:mm");
            console.log(firstTrain);
            // var firstTrainConverted = $(firstTrain).toString();
            // var firstTrainTime = moment(firstTrainConverted).format("HH:mm");
            // var firstTrainTime = moment($(firstTrain))
            // moment($("#start-input").val().trim(), "DD/MM/YY").format("X");
            // console.log(firstTrainTime);
          
        

            var frequencyMin = $("#frequency-input").val().trim();

            var newTrain = {
                name: trainName,
                destination: destination,
                firstTrain: firstTrain,
                frequency: frequencyMin
            };
            

            var newTrainRef = database.ref().push(newTrain);
            
            $("#train-name-input").val("");
            $("#destination-input").val("");
            $("#first-train-input").val("");
            $("#frequency-input").val("");


        });

        database.ref().on("child_added", function (snapshot) {
            var trainsObject = snapshot.val();
            var trainSchedule = $("tbody");

            // console.log(trainsObject);


            let trainRow = $("<tr>");
            let nextArrival = getNextArrival(trainsObject.frequency, trainsObject.firstTrain);
            let minutesAway = getMinutesAway(trainsObject.frequency, trainsObject.firstTrain);

            trainRow.append("<td>" + trainsObject.name + "</td>");
            trainRow.append("<td>" + trainsObject.destination + "</td>");
            trainRow.append("<td>" + trainsObject.frequency + "</td>");
            trainRow.append("<td>" + nextArrival + "</td>");
            trainRow.append("<td>" + minutesAway + "</td>");

            trainSchedule.append(trainRow);




        });

        function getNextArrival(frequency, firstTrain) {
            var nextArrival = "10:15";

            return nextArrival

        }

        function getMinutesAway(frequency, firstTrain) {
            //equation to get minutes away
            var minutesAway = "5";

            return minutesAway
        }

//adding child
//childSnapshot?
//to get minutes away --> get current time, get first train time, get frequency
// ex. if first train is at 5:05 am, frequency is 15 minutes, current time is 4:30
// 

//bonus - add update and remove buttons



    </script>

</body>

</html>